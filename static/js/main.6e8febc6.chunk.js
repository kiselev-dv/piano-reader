(this["webpackJsonppiano-trainer"]=this["webpackJsonppiano-trainer"]||[]).push([[0],{44:function(e,t,n){e.exports=n(84)},49:function(e,t,n){},54:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),i=n(39),r=n.n(i),c=(n(49),n(4)),o=n(5),l=n(15),h=n(14),u=n(6),v=n(16),f=n(9);n(53);function d(e){var t=f.b.fromNote("c2"),n=f.b.fromNote("c7"),a=f.a.create({firstNote:f.b.fromNote("c4"),lastNote:n,keyboardConfig:f.a.HOME_ROW});return s.a.createElement("div",{className:"piano-container"},s.a.createElement(f.c,{className:"test",noteRange:{first:t,last:n},playNote:e.playNote,stopNote:e.stopNote,width:e.width,keyWidthToHeight:.2,keyboardShortcuts:a,activeNotes:e.activeNotes}))}var m=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={value:null,options:[]},navigator.requestMIDIAccess().then(n.gainAccess.bind(Object(u.a)(n))),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.connect=n.connect.bind(Object(u.a)(n)),n}return Object(v.a)(t,e),Object(o.a)(t,[{key:"gainAccess",value:function(e){this.setInputs(e.inputs);var t=this;e.onstatechange=function(n){console.log(n.port.name,n.port.manufacturer,n.port.state),t.setInputs(e.inputs)}}},{key:"setInputs",value:function(e){this.inputs=e;var t=[],n=!0,a=!1,s=void 0;try{for(var i,r=e.values()[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var c=i.value;t.push({key:c.id,value:c.id,text:c.name})}}catch(o){a=!0,s=o}finally{try{n||null==r.return||r.return()}finally{if(a)throw s}}this.setState({options:t})}},{key:"connect",value:function(){this.props.onConnect(this.getSelectedInput())}},{key:"getSelectedInput",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,s=this.inputs.values()[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var i=a.value;if(i.id===this.state.value)return i}}catch(r){t=!0,n=r}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}return null}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"createSelectItems",value:function(){var e=[];return this.state.options.forEach((function(t){e.push(s.a.createElement("option",{key:t.key,value:t.value},t.text))})),e}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("select",{defaultValue:"label",onChange:this.handleChange},s.a.createElement("option",{value:"label",disabled:!0},"Select midi device"),this.createSelectItems()),s.a.createElement("button",{onClick:this.connect},"Connect"))}}]),t}(s.a.Component);n(54);function b(e){var t=e.lesson,n=e.selected,a=e.onClick;return s.a.createElement("div",{className:"lesson ".concat(n?"selected":""),onClick:function(){a(t)}},s.a.createElement("div",{className:"wrapper"},s.a.createElement("h4",null,t.heder),s.a.createElement("div",null,t.subtitle)))}function y(e){var t=e.selectedLesson,n=e.lessons,a=e.onSelect,i=n.map((function(e,n){return s.a.createElement(b,{key:n,lesson:e,selected:e===t,onClick:function(){a(e)}})}));return s.a.createElement("div",{className:"lessons"},i)}var p=n(40),E=function(){function e(){Object(c.a)(this,e),this.listeners=[]}return Object(o.a)(e,[{key:"on",value:function(e){this.listeners.push(e)}},{key:"off",value:function(e){var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.listeners.forEach((function(e){return e.apply(void 0,t)}))}}]),e}(),g=["C","^C","D","^D","E","F","^F","G","^G","A","^A","B"];function C(e,t){var n="";return e&&e.forEach((function(e){n+=function(e){var t=(e/12|0)-5,n=g[e%12];return 0===t?n:1===t?n.toLowerCase():t>1?n.toLowerCase()+"'".repeat(t-1):t<0?n+",".repeat(-1*t):null}(e)})),n&&t&&(n="["+n+"]"),n}var x=function(){function e(){Object(c.a)(this,e),this.activeNotes=[],this.stateChangeEvent=new E}return Object(o.a)(e,[{key:"addNote",value:function(e){this.activeNotes.indexOf(e)<0&&this.activeNotes.push(e),this.stateChangeEvent.fire(this.activeNotes)}},{key:"removeNote",value:function(e){var t=this.activeNotes.indexOf(e);t>-1&&this.activeNotes.splice(t,1),this.stateChangeEvent.fire(this.activeNotes)}},{key:"handleMidiMessage",value:function(e){var t=e.data,n=t[0],a=t[1];144===n&&this.addNote(a),128===n&&this.removeNote(a)}},{key:"handleKeyboard",value:function(e,t){t?this.removeNote(e):this.addNote(e)}}]),e}();var k=function(e){var t,n,a,i=e.key,r=e.system,c=e.clef,o=e.grandStave;c||1!==r.length||(c=r[0].clef||"treble"),(a=r).some((function(e){return"bass"===e.clef}))&&a.some((function(e){return"treble"===(e.clef||"treble")}))&&(o=!0);var l=r.find((function(e){return"treble"===(e.clef||c)})),h=r.find((function(e){return"bass"===(e.clef||c)})),u=l||h,v=e.activeABC||C(e.activeNotes);if(o){var f="bass"===c?"":v,d=l?l.abc:"";l&&f&&(d+="&",n=1),d+=f;var m="bass"===c?v:"",b=h?h.abc:"";h&&m&&(b+="&",n=2),b+=m,v||(b+=" & []"),t="\n            K: ".concat(i||""," clef=").concat(c||"treble","\n            L:1/4\n            M:4/4\n            %%staves {V1 V2}\n            V: V1 clef=treble\n            V: V2 clef=bass\n            [V: V1]|| ").concat(d,"\n            [V: V2]|| ").concat(b,"\n        ")}else{var y=u?u.abc:"";y&&v&&(y+="&",n=1),y+=v,v||(y+=" & []"),t="\n            K: ".concat(i||""," clef=").concat(c||"treble","\n            L:1/4\n            M:4/4\n            || ").concat(y,"\n        ")}var E=e.activeAbcFill||"#3AC8DA";return s.a.createElement("div",{className:"stave-container"},s.a.createElement("style",{jsx:"true"},"\n                path.abcjs-note.abcjs-v".concat(n," {\n                    fill: ").concat(E,";\n                }\n            ")),s.a.createElement(p.a,{abcNotation:t,parserParams:{},engraverParams:{responsive:"none",add_classes:!0},renderParams:{viewportHorizontal:!0}}),e.renderABC&&s.a.createElement("div",{style:{whiteSpace:"pre"}},t))},A=n(43);function N(e){return function(t){return{system:[Object(A.a)({},e,{abc:t})]}}}var O=[{heder:"Treble clef",subtitle:"Markers (C G)",grandStave:!1,createExercises:function(){return"C G c g c' G,".split(" ").map(N({clef:"treble"}))}},{heder:"Bass clef",subtitle:"Markers (C F)",grandStave:!1,createExercises:function(){return"C,, F,, C, F, C F c".split(" ").map(N({clef:"bass"}))}},{heder:"Treble clef",subtitle:"Full",grandStave:!1,createExercises:function(){return"G, A B C D E F G a b c d e f g'".split(" ").map(N({clef:"treble"}))}},{heder:"Chords",subtitle:"One Four Five",grandStave:!1,createExercises:function(){return["[C E G]","C E G","[F A c]"].map(N({clef:"treble"}))}}],w=n(42),S=/([_^]?[abcdefgABCDEFG]{1}[,']*)/g;function j(e){var t=[];return e&&e.forEach((function(e){t=t.concat(function(e){return Object(w.a)(e.matchAll(S)).map((function(e){return e[0]}))}(e.abc).map((function(e){return function(e){var t=e.indexOf("^")>-1,n=e.indexOf("_")>-1,a=e.match(/[ABCDEFGabcdefg]/)[0],s=a.toLowerCase()===a,i=e.match(/[']+/)?e.match(/[']+/)[0].length:0,r=e.match(/[,]+/)?e.match(/[,]+/)[0].length:0,c=["c","c","d","d","e","f","f","g","g","a","a","b"].indexOf(a.toLowerCase());return t&&c++,n&&c++,s&&(c+=12),c+=12*i,c-=12*r,c+=60}(e)})))})),t}var _=function(){function e(t){Object(c.a)(this,e),this.matchEvent=new E,this.hitEvent=new E,this.missEvent=new E,this.reset(t)}return Object(o.a)(e,[{key:"reset",value:function(e){this.system=e,this.notes=j(this.system),this.matchOneByOne=!function(e){return e.some((function(e){return e.abc.includes("[")}))}(this.system),this._matched=[],this._missed=[]}},{key:"setActiveNotes",value:function(e){var t=this;this.matchOneByOne||(this._matched=[]);var n=B(this.notes,this._matched);n&&this.matchEvent.fire(this.notes);var a=this.notes.filter((function(e){return!t._matched.includes(e)}));this.matchOneByOne&&!n&&this.notes.length>0&&this._matched.length<this.notes.length&&(a=[this.notes[this._matched.length]]),this._missed=e.filter((function(e){return!a.includes(e)})),0!==this._missed.length&&this.missEvent.fire(this._missed);var s=e.filter((function(e){return a.includes(e)}));!n&&s.length>0&&this.hitEvent.fire(s),s.forEach((function(e){return t._matched.push(e)})),console.log(this.notes,this._matched),(n=B(this.notes,this._matched))&&0===this._missed.length&&this.matchEvent.fire(this._matched)}},{key:"activeNotesAsABC",value:function(e){return C(e,!this.matchOneByOne)}},{key:"match",value:function(e){var t=[],n=!0,a=!1,s=void 0;try{for(var i,r=e[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var c=i.value;this.notes.indexOf(c)>=0&&t.push(c)}}catch(o){a=!0,s=o}finally{try{n||null==r.return||r.return()}finally{if(a)throw s}}return t.length===e.length&&t.length===this.notes.length}}]),e}();function B(e,t){return e.length===t.length&&e.every((function(e){return t.includes(e)}))}function F(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];e.call.apply(e,[t].concat(s,a))}}function G(e){return e[Math.floor(Math.random()*e.length)]}var M=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).notes=new x,n.notes.stateChangeEvent.on(n.handleActiveNotes.bind(Object(u.a)(n)));var a=O[0],s=a.createExercises();return n._hit=0,n._miss=0,n.state={lesson:a,activeNotes:[],activeABC:"",exercises:s,exercise:G(s),showStaveABC:!1,showGrandStave:!1},n.matcher=new _(n.state.exercise.system),n.matcher.matchEvent.on(n.match.bind(Object(u.a)(n))),n.matcher.missEvent.on(n.miss.bind(Object(u.a)(n))),n}return Object(v.a)(t,e),Object(o.a)(t,[{key:"handleActiveNotes",value:function(e){this.matcher.setActiveNotes(e);var t=this.matcher.activeNotesAsABC(e);this.setState({activeNotes:e,activeABC:t}),0===e.length&&this.nextExerciseAwaits&&this.nextExercise()}},{key:"handleMidiConnect",value:function(e){if(e){var t=this.notes;e.onmidimessage=t.handleMidiMessage.bind(t)}}},{key:"handleLessonChange",value:function(e){var t=e.createExercises(),n=G(t),a={lesson:e,exercise:n,exercises:t};this.setState(a),this.matcher.reset(n.system),this._hit=0,this._miss=0}},{key:"match",value:function(){this.nextExerciseAwaits||(this._hit++,this.nextExerciseAwaits=!0)}},{key:"miss",value:function(){this.nextExerciseAwaits||this._miss++}},{key:"nextExercise",value:function(){this.nextExerciseAwaits=!1;var e=G(this.state.exercises);this.setState({exercise:e}),this.matcher.reset(e.system)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"game"},s.a.createElement(m,{onConnect:this.handleMidiConnect.bind(this)}),s.a.createElement("div",null,"Hit: ",this._hit,", Miss: ",this._miss,", \xa0",s.a.createElement("input",{type:"checkbox",onChange:function(t){e.setState({showStaveABC:t.target.checked})}}),"\xa0",s.a.createElement("label",null,"Show stave ABC"),"\xa0",s.a.createElement("input",{type:"checkbox",onChange:function(t){e.setState({showGrandStave:t.target.checked})}}),"\xa0",s.a.createElement("label",null,"Show Grand Stave")),s.a.createElement(y,{selectedLesson:this.state.lesson,lessons:O,onSelect:this.handleLessonChange.bind(this)}),s.a.createElement(k,{activeABC:this.state.activeABC,activeAbcFill:this.nextExerciseAwaits?"#30C72C":"#3AC8DA",grandStave:this.state.lesson.grandStave||this.state.showGrandStave,system:this.state.exercise.system,renderABC:this.state.showStaveABC}),s.a.createElement("div",null,s.a.createElement("button",{style:{width:"100px"},onClick:this.nextExercise.bind(this)},"Skip")),s.a.createElement(d,{width:1600,activeNotes:this.state.activeNotes,playNote:F(this.notes.handleKeyboard,this.notes,!1),stopNote:F(this.notes.handleKeyboard,this.notes,!0)}))}}]),t}(s.a.Component);r.a.render(s.a.createElement(M,null),document.getElementById("root"))}},[[44,1,2]]]);
//# sourceMappingURL=main.6e8febc6.chunk.js.map