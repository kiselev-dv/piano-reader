(this["webpackJsonppiano-trainer"]=this["webpackJsonppiano-trainer"]||[]).push([[0],{43:function(e,t,n){e.exports=n(83)},48:function(e,t,n){},53:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),i=n(39),r=n.n(i),o=(n(48),n(2)),c=n(3),l=n(12),u=n(11),h=n(5),v=n(13),f=n(9);n(52);function d(e){var t=f.b.fromNote("c2"),n=f.b.fromNote("c7"),a=f.a.create({firstNote:f.b.fromNote("c4"),lastNote:n,keyboardConfig:f.a.HOME_ROW});return s.a.createElement("div",{className:"piano-container"},s.a.createElement(f.c,{className:"test",noteRange:{first:t,last:n},playNote:e.playNote,stopNote:e.stopNote,width:e.width,keyWidthToHeight:.2,keyboardShortcuts:a,activeNotes:e.activeNotes}))}var m=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={value:null,options:[]},navigator.requestMIDIAccess().then(n.gainAccess.bind(Object(h.a)(n))),n.handleChange=n.handleChange.bind(Object(h.a)(n)),n.connect=n.connect.bind(Object(h.a)(n)),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"gainAccess",value:function(e){this.setInputs(e.inputs);var t=this;e.onstatechange=function(n){console.log(n.port.name,n.port.manufacturer,n.port.state),t.setInputs(e.inputs)}}},{key:"setInputs",value:function(e){this.inputs=e;var t=[],n=!0,a=!1,s=void 0;try{for(var i,r=e.values()[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var o=i.value;t.push({key:o.id,value:o.id,text:o.name})}}catch(c){a=!0,s=c}finally{try{n||null==r.return||r.return()}finally{if(a)throw s}}this.setState({options:t})}},{key:"connect",value:function(){this.props.onConnect(this.getSelectedInput())}},{key:"getSelectedInput",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,s=this.inputs.values()[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var i=a.value;if(i.id===this.state.value)return i}}catch(r){t=!0,n=r}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}return null}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"createSelectItems",value:function(){var e=[];return this.state.options.forEach((function(t){e.push(s.a.createElement("option",{key:t.key,value:t.value},t.text))})),e}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("select",{defaultValue:"label",onChange:this.handleChange},s.a.createElement("option",{value:"label",disabled:!0},"Select midi device"),this.createSelectItems()),s.a.createElement("button",{onClick:this.connect},"Connect"))}}]),t}(s.a.Component);n(53);function b(e,t){return e.split(" ").map((function(e){return{system:[{clef:t||"treble",abc:e}]}}))}var y=[{heder:"Treble clef",subtitle:"(Only markers)",generator:b.bind(null,"C G c g c' G,")},{heder:"Bass clef",subtitle:"(Only markers)",generator:b.bind(null,"C,, F,, C, F, C F c","bass")}],p=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={lesson:e.lesson},n.renderLesson=n.renderLesson.bind(Object(h.a)(n)),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"handleClick",value:function(e){this.setState({lesson:e}),this.props.onSelect&&this.props.onSelect(e)}},{key:"renderLesson",value:function(e,t){var n="lesson";return this.state.lesson===e&&(n+=" selected"),s.a.createElement("div",{key:t,className:n,onClick:this.handleClick.bind(this,e)},s.a.createElement("div",{className:"wrapper"},s.a.createElement("h4",null,e.heder),s.a.createElement("div",null,e.subtitle)))}},{key:"renderLessons",value:function(e){return e.map(this.renderLesson)}},{key:"render",value:function(){return s.a.createElement("div",{className:"lessons"},this.renderLessons(this.props.lessons))}}]),t}(s.a.Component),g=n(40),N=function(){function e(){Object(o.a)(this,e),this.listeners=[]}return Object(c.a)(e,[{key:"on",value:function(e){this.listeners.push(e)}},{key:"off",value:function(e){var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.listeners.forEach((function(e){return e.apply(void 0,t)}))}}]),e}(),C=["C","^C","D","^D","E","F","^F","G","^G","A","^A","B"];function k(e,t){var n="";return e&&e.forEach((function(e){n+=function(e){var t=(e/12|0)-5,n=C[e%12];return 0===t?n:1===t?n.toLowerCase():t>1?n.toLowerCase()+"'".repeat(t-1):t<0?n+",".repeat(-1*t):null}(e)})),n&&t&&(n="["+n+"]"),n}var E=function(){function e(){Object(o.a)(this,e),this.activeNotes=[],this.stateChangeEvent=new N}return Object(c.a)(e,[{key:"addNote",value:function(e){this.activeNotes.indexOf(e)<0&&this.activeNotes.push(e),this.stateChangeEvent.fire(this.activeNotes)}},{key:"removeNote",value:function(e){var t=this.activeNotes.indexOf(e);t>-1&&this.activeNotes.splice(t,1),this.stateChangeEvent.fire(this.activeNotes)}},{key:"handleMidiMessage",value:function(e){var t=e.data,n=t[0],a=t[1];144===n&&this.addNote(a),128===n&&this.removeNote(a)}},{key:"handleKeyboard",value:function(e,t){t?this.removeNote(e):this.addNote(e)}}]),e}();var O=function(e){var t,n,a,i=e.key,r=e.system,o=e.clef,c=e.grandStave;o||1!==r.length||(o=r[0].clef||"treble"),(a=r).some((function(e){return"bass"===e.clef}))&&a.some((function(e){return"treble"===(e.clef||"treble")}))&&(c=!0);var l=r.find((function(e){return"treble"===(e.clef||o)})),u=r.find((function(e){return"bass"===(e.clef||o)})),h=l||u,v=e.activeABC||k(e.activeNotes);if(c){var f="bass"===o?"":v,d=l?l.abc:"";l&&f&&(d+="&",n=1),d+=f;var m="bass"===o?v:"",b=u?u.abc:"";u&&m&&(b+="&",n=2),b+=m,v||(b+=" & []"),t="\n            K: ".concat(i||""," clef=").concat(o||"treble","\n            L:1/4\n            M:4/4\n            %%staves {V1 V2}\n            V: V1 clef=treble\n            V: V2 clef=bass\n            [V: V1]|| ").concat(d,"\n            [V: V2]|| ").concat(b,"\n        ")}else{var y=h?h.abc:"";y&&v&&(y+="&",n=1),y+=v,v||(y+=" & []"),t="\n            K: ".concat(i||""," clef=").concat(o||"treble","\n            L:1/4\n            M:4/4\n            || [").concat(y,"]\n        ")}return s.a.createElement("div",{className:"stave-container"},s.a.createElement("style",{jsx:"true"},"\n                path.abcjs-note.abcjs-v".concat(n," {\n                    fill: #3AC8DA;\n                }\n            ")),s.a.createElement(g.a,{abcNotation:t,parserParams:{},engraverParams:{responsive:"none",add_classes:!0},renderParams:{viewportHorizontal:!0}}),e.renderABC&&s.a.createElement("div",{style:{whiteSpace:"pre"}},t))},j=n(42),A=/([_^]?[abcdefgABCDEFG]{1}[,']*)/g;function w(e){var t=[];return e&&e.forEach((function(e){t=t.concat(function(e){return Object(j.a)(e.matchAll(A)).map((function(e){return e[0]}))}(e.abc).map((function(e){return function(e){var t=e.indexOf("^")>-1,n=e.indexOf("_")>-1,a=e.match(/[ABCDEFGabcdefg]/)[0],s=a.toLowerCase()===a,i=e.match(/[']+/)?e.match(/[']+/)[0].length:0,r=e.match(/[,]+/)?e.match(/[,]+/)[0].length:0,o=["c","c","d","d","e","f","f","g","g","a","a","b"].indexOf(a.toLowerCase());return t&&o++,n&&o++,s&&(o+=12),o+=12*i,o-=12*r,o+=60}(e)})))})),t}var S=function(){function e(t){Object(o.a)(this,e),this.lesson=t,this.lessonNoteNumbers=w(this.lesson)}return Object(c.a)(e,[{key:"reset",value:function(e){this.lesson=e,this.lessonNoteNumbers=w(this.lesson)}},{key:"match",value:function(e){var t=[],n=!0,a=!1,s=void 0;try{for(var i,r=e[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var o=i.value;this.lessonNoteNumbers.indexOf(o)>=0&&t.push(o)}}catch(c){a=!0,s=c}finally{try{n||null==r.return||r.return()}finally{if(a)throw s}}return t.length===e.length&&t.length===this.lessonNoteNumbers.length}}]),e}(),x=function(){function e(t){Object(o.a)(this,e),this.matcher=t,this.accumulator=[],this.hitEvent=new N,this.missEvent=new N}return Object(c.a)(e,[{key:"handleActiveNotes",value:function(e){this.matcher.match(e)&&this.hitEvent.fire(),B(e)?this.addActiveNotes(e):(B(this.accumulator)&&(this.missEvent.fire(),console.log(e,this.accumulator)),this.accumulator=[])}},{key:"addActiveNotes",value:function(e){var t=this;e.forEach((function(e){t.accumulator.indexOf(e)<0&&t.accumulator.push(e)}),this)}}]),e}();function B(e){return!e||0===e.length}function M(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];e.call.apply(e,[t].concat(s,a))}}var L=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).notes=new E,n.notes.stateChangeEvent.on(n.handleActiveNotes.bind(Object(h.a)(n)));var a=y[0].generator();return n._hit=0,n._miss=0,n.state={activeNotes:[],activeABC:"",lesson:a[0],lessons:a,showStaveABC:!1},n.matcher=new S(n.state.lesson.system),n.stat=new x(n.matcher),n.stat.hitEvent.on(n.hit.bind(Object(h.a)(n))),n.stat.missEvent.on(n.miss.bind(Object(h.a)(n))),n}return Object(v.a)(t,e),Object(c.a)(t,[{key:"handleActiveNotes",value:function(e){var t=k(e,!0);this.setState({activeNotes:e,activeABC:t}),this.stat.handleActiveNotes(e)}},{key:"handleMidiConnect",value:function(e){var t=this.notes;e.onmidimessage=t.handleMidiMessage.bind(t)}},{key:"handleCourseChange",value:function(e){var t=e.generator(),n={lesson:t[0],lessons:t};this.setState(n),this._hit=0,this._miss=0}},{key:"hit",value:function(){var e=this;this._hit++,setTimeout((function(){var t,n=(t=e.state.lessons)[Math.floor(Math.random()*t.length)];e.setState({lesson:n}),e.matcher.reset(n.system)}),300)}},{key:"miss",value:function(){this._miss++}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"game"},s.a.createElement(m,{onConnect:this.handleMidiConnect.bind(this)}),s.a.createElement("div",null,"Hit: ",this._hit,", Miss: ",this._miss,", \xa0",s.a.createElement("input",{type:"checkbox",onChange:function(t){e.setState({showStaveABC:t.target.checked})}}),"\xa0",s.a.createElement("label",null,"Show stave ABC")),s.a.createElement(p,{lesson:y[0],lessons:y,onSelect:this.handleCourseChange.bind(this)}),s.a.createElement(O,{activeABC:this.state.activeABC,grandStave:!1,system:this.state.lesson.system,renderABC:this.state.showStaveABC}),s.a.createElement(d,{width:1600,activeNotes:this.state.activeNotes,playNote:M(this.notes.handleKeyboard,this.notes,!1),stopNote:M(this.notes.handleKeyboard,this.notes,!0)}))}}]),t}(s.a.Component);r.a.render(s.a.createElement(L,null),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.16a15f6d.chunk.js.map