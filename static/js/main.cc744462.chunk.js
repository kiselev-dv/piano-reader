(this["webpackJsonppiano-trainer"]=this["webpackJsonppiano-trainer"]||[]).push([[0],{49:function(e,t,n){},55:function(e,t,n){},85:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n(41),a=n.n(s),i=(n(49),n(3)),r=n(9),o=(n(53),n(2));function l(e){var t=r.b.fromNote("c2"),n=r.b.fromNote("c7"),c=r.a.create({firstNote:r.b.fromNote("c4"),lastNote:n,keyboardConfig:r.a.HOME_ROW});return Object(o.jsx)("div",{className:"piano-container",children:Object(o.jsx)(r.c,{className:"test",noteRange:{first:t,last:n},playNote:e.playNote,stopNote:e.stopNote,width:e.width,keyWidthToHeight:.2,keyboardShortcuts:c,activeNotes:e.activeNotes})})}function u(e,t){var n=Object(c.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(c){return console.log(c),t}})),s=Object(i.a)(n,2),a=s[0],r=s[1];return[a,function(t){try{var n=t instanceof Function?t(a):t;r(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(c){console.log(c)}}]}function h(e){var t=e.activeInput,n=u("autoconnect-midi-input-ids",[]),c=Object(i.a)(n,2),s=c[0],a=c[1],r=t&&t.onmidimessage;if(!t)return null;return Object(o.jsxs)("span",{children:[Object(o.jsx)("label",{className:r?"connected":"",children:"connected"}),Object(o.jsxs)("label",{children:["\xa0 autoconnect \xa0",Object(o.jsx)("input",{type:"checkbox",checked:s.includes(t.id),onChange:function(){if(!s.includes(t.id)){if(s.includes(t.id))return;s.push(t.id),a(s)}else a(s.filter((function(e){return e!==t.id})))}})]})]})}var f=function(e){var t=e.notes,n=Object(c.useState)(),s=Object(i.a)(n,2),a=s[0],r=s[1],l=Object(c.useState)(),f=Object(i.a)(l,2),b=f[0],d=f[1],v=u("autoconnect-midi-input-ids",[]),j=Object(i.a)(v,1)[0];Object(c.useEffect)((function(){navigator.requestMIDIAccess().then((function(e){r(e.inputs),e.onstatechange=function(t){console.log(t.port.name,t.port.manufacturer,t.port.state),r(e.inputs)}}))}),[]),Object(c.useEffect)((function(){b&&!a.has(b.id)&&d(null)}),[a,b]),Object(c.useEffect)((function(){if(a){var e=Array.from(a.values()).find((function(e){return j.includes(e.id)}));e&&d(e)}}),[a,j]);var O=Array.from(a?a.values():[]).map((function(e){return Object(o.jsx)("option",{value:e.id,children:e.name},e.id)})),m=Object(c.useCallback)((function(e){d(a.get(e.target.value))}),[a]);return Object(c.useEffect)((function(){b&&(b.onmidimessage=t.handleMidiMessage.bind(t))}),[b,t]),Object(o.jsxs)("div",{children:[Object(o.jsxs)("select",{value:b?b.id:"label",onChange:m,children:[Object(o.jsx)("option",{value:"label",disabled:!0,children:"Select midi device"}),O]}),"\xa0",Object(o.jsx)(h,{activeInput:b})]})},b=n(5),d=n(29);function v(e){return function(t){return{system:[Object(d.a)(Object(d.a)({},e),{},{abc:t})]}}}var j="C G c g c' G,",O="G, B, D E F A c e g b",m="A, C E G B d f a c'",p="C,, F,, C, F, C F",g="F,, A,, C, E, G, B, D",y="C,, E,, G,, B,, D, F, A, C E";var x=[{key:"markers-all",heder:"Markers",subtitle:"C G / C F",grandStave:!0,exercises:[].concat(Object(b.a)(j.split(" ").map(v({clef:"treble"}))),Object(b.a)(p.split(" ").map(v({clef:"bass"}))))},{key:"treble-spaces",heder:"Spaces",subtitle:"Treble clef",grandStave:!1,exercises:O.split(" ").map(v({clef:"treble"}))},{key:"bass-spaces",heder:"Spaces",subtitle:"Bass clef",grandStave:!1,exercises:g.split(" ").map(v({clef:"bass"}))},{key:"treble-lines",heder:"Lines",subtitle:"Treble clef",grandStave:!1,exercises:m.split(" ").map(v({clef:"treble"}))},{key:"bass-lines",heder:"Lines",subtitle:"Bass clef",grandStave:!1,exercises:y.split(" ").map(v({clef:"bass"}))},{key:"treble-all",heder:"Treble clef",subtitle:"All",grandStave:!1,exercises:[].concat(Object(b.a)(O.split(" ").map(v({clef:"treble"}))),Object(b.a)(m.split(" ").map(v({clef:"treble"}))))},{key:"bass-all",heder:"Bass clef",subtitle:"All",grandStave:!1,exercises:[].concat(Object(b.a)(g.split(" ").map(v({clef:"bass"}))),Object(b.a)(y.split(" ").map(v({clef:"bass"}))))},{key:"grand-stave",heder:"Grand Stave",subtitle:"All",grandStave:!0,exercises:[].concat(Object(b.a)(O.split(" ").map(v({clef:"treble"}))),Object(b.a)(m.split(" ").map(v({clef:"treble"}))),Object(b.a)(g.split(" ").map(v({clef:"bass"}))),Object(b.a)(y.split(" ").map(v({clef:"bass"}))))},{key:"chords",heder:"Chords",subtitle:"",grandStave:!1,exercises:["[C E G]","C E G","[F A c]"].map(v({clef:"treble"}))}];n(55);function C(e){var t=e.selected,n=e.onChange,s=e.onClick,a=e.lesson;return Object(c.useEffect)((function(){t&&n(a.exercises,a)}),[t,a,a.exercises,n]),Object(o.jsx)("div",{className:"lesson ".concat(t?"selected":""),onClick:s,children:Object(o.jsxs)("div",{className:"wrapper",children:[Object(o.jsx)("h4",{children:a.heder}),Object(o.jsx)("div",{children:a.subtitle})]})})}function k(e){var t=e.onExercisesUpdate,n=Object(c.useState)(x[0].key),s=Object(i.a)(n,2),a=s[0],r=s[1];return Object(o.jsx)("div",{className:"lessons",children:x.map((function(e){return Object(o.jsx)(C,{lesson:e,selected:a===e.key,onClick:function(){r(e.key)},onChange:t},e.key)}))})}var N=n(42),E=n(12),S=n(13),A=function(){function e(){Object(E.a)(this,e),this.listeners=[]}return Object(S.a)(e,[{key:"on",value:function(e){this.listeners.push(e)}},{key:"off",value:function(e){var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.listeners.forEach((function(e){return e.apply(void 0,t)}))}}]),e}(),w=["C","^C","D","^D","E","F","^F","G","^G","A","^A","B"];function B(e,t){var n="";return e&&e.forEach((function(e){n+=function(e){var t=(e/12|0)-5,n=w[e%12];return 0===t?n:1===t?n.toLowerCase():t>1?n.toLowerCase()+"'".repeat(t-1):t<0?n+",".repeat(-1*t):null}(e)})),n&&t&&(n="["+n+"]"),n}var _=function(){function e(){Object(E.a)(this,e),this.activeNotes=[],this.stateChangeEvent=new A}return Object(S.a)(e,[{key:"addNote",value:function(e){this.activeNotes.indexOf(e)<0&&this.activeNotes.push(e),this.stateChangeEvent.fire(this.activeNotes)}},{key:"removeNote",value:function(e){var t=this.activeNotes.indexOf(e);t>-1&&this.activeNotes.splice(t,1),this.stateChangeEvent.fire(this.activeNotes)}},{key:"handleMidiMessage",value:function(e){var t=e.data,n=t[0],c=t[1];144===n&&this.addNote(c),128===n&&this.removeNote(c)}},{key:"handleKeyboard",value:function(e,t){t?this.removeNote(e):this.addNote(e)}}]),e}();function F(e){var t,n,c,s=e.key,a=e.system,i=e.clef,r=e.grandStave;i||1!==a.length||(i=a[0].clef||"treble"),(c=a).some((function(e){return"bass"===e.clef}))&&c.some((function(e){return"treble"===(e.clef||"treble")}))&&(r=!0);var l=a.find((function(e){return"treble"===(e.clef||i)})),u=a.find((function(e){return"bass"===(e.clef||i)})),h=l||u,f=e.activeABC||B(e.activeNotes);if(r){var b="bass"===i?"":f,d=l?l.abc:"";l&&b&&(d+="&",n=1),d+=b;var v="bass"===i?f:"",j=u?u.abc:"";u&&v&&(j+="&",n=2),j+=v,f||(j+=" & []"),t="\n            K: ".concat(s||""," clef=").concat(i||"treble","\n            L:1/4\n            M:4/4\n            %%staves {V1 V2}\n            V: V1 clef=treble\n            V: V2 clef=bass\n            [V: V1]|| ").concat(d,"\n            [V: V2]|| ").concat(j,"\n        ")}else{var O=h?h.abc:"";O&&f&&(O+="&",n=1),O+=f,f||(O+=" & []"),t="\n            K: ".concat(s||""," clef=").concat(i||"treble","\n            L:1/4\n            M:4/4\n            || ").concat(O,"\n        ")}var m=e.activeAbcFill||"#3AC8DA";return Object(o.jsxs)("div",{className:"stave-container",children:[Object(o.jsx)("style",{jsx:"true",children:"\n                path.abcjs-note.abcjs-v".concat(n," {\n                    fill: ").concat(m,";\n                }\n            ")}),Object(o.jsx)(N.a,{abcNotation:t,parserParams:{},engraverParams:{responsive:"none",add_classes:!0},renderParams:{viewportHorizontal:!0}}),e.debugABC&&Object(o.jsx)("div",{style:{whiteSpace:"pre"},children:t})]})}var G=n(44),M=/([_^]?[abcdefgABCDEFG]{1}[,']*)/g;function D(e){var t=[];return e&&e.forEach((function(e){t=t.concat(function(e){return Object(b.a)(e.matchAll(M)).map((function(e){return e[0]}))}(e.abc).map((function(e){return function(e){var t=e.indexOf("^")>-1,n=e.indexOf("_")>-1,c=e.match(/[ABCDEFGabcdefg]/)[0],s=c.toLowerCase()===c,a=e.match(/[']+/)?e.match(/[']+/)[0].length:0,i=e.match(/[,]+/)?e.match(/[,]+/)[0].length:0,r=["c","c","d","d","e","f","f","g","g","a","a","b"].indexOf(c.toLowerCase());return t&&r++,n&&r++,s&&(r+=12),r+=12*a,(r-=12*i)+60}(e)})))})),t}var V=function(){function e(t){Object(E.a)(this,e),this.matchEvent=new A,this.hitEvent=new A,this.missEvent=new A,t&&this.reset(t)}return Object(S.a)(e,[{key:"reset",value:function(e){this.system=e,this.notes=D(this.system),this.matchOneByOne=!function(e){return e.some((function(e){return e.abc.includes("[")}))}(this.system),this._matched=[],this._missed=[]}},{key:"setActiveNotes",value:function(e){var t=this;this.matchOneByOne||(this._matched=[]);var n=L(this.notes,this._matched);n&&this.matchEvent.fire(this.notes);var c=this.notes.filter((function(e){return!t._matched.includes(e)}));this.matchOneByOne&&!n&&this.notes.length>0&&this._matched.length<this.notes.length&&(c=[this.notes[this._matched.length]]),this._missed=e.filter((function(e){return!c.includes(e)})),0!==this._missed.length&&this.missEvent.fire(this._missed);var s=e.filter((function(e){return c.includes(e)}));!n&&s.length>0&&this.hitEvent.fire(s),s.forEach((function(e){return t._matched.push(e)})),(n=L(this.notes,this._matched))&&0===this._missed.length&&this.matchEvent.fire(this._matched)}},{key:"activeNotesAsABC",value:function(e){return B(e,!this.matchOneByOne||this.notes.length<=1)}},{key:"match",value:function(e){var t,n=[],c=Object(G.a)(e);try{for(c.s();!(t=c.n()).done;){var s=t.value;this.notes.indexOf(s)>=0&&n.push(s)}}catch(a){c.e(a)}finally{c.f()}return n.length===e.length&&n.length===this.notes.length}}]),e}();function L(e,t){return e.length===t.length&&e.every((function(e){return t.includes(e)}))}function I(e){return Object(c.useRef)(e).current}function R(e){var t=Object(c.useRef)();t.current=e;var n=Object(c.useRef)((function(){return t.current.apply(t,arguments)}));return n.current}function K(e,t){var n=e[Math.floor(Math.random()*e.length)];return t&&e.length>1&&n===t?K(e,t):n}function J(){var e=I(new _),t=I(new V),n=Object(c.useState)([]),s=Object(i.a)(n,2),a=s[0],r=s[1],u=Object(c.useState)(),h=Object(i.a)(u,2),b=h[0],d=h[1],v=Object(c.useState)(),j=Object(i.a)(v,2),O=j[0],m=j[1],p=Object(c.useState)(),g=Object(i.a)(p,2),y=g[0],x=g[1],C=Object(c.useState)(),N=Object(i.a)(C,2),E=N[0],S=N[1],A=Object(c.useState)(!1),w=Object(i.a)(A,2),B=w[0],G=w[1],M=Object(c.useState)(!1),D=Object(i.a)(M,2),L=D[0],J=D[1],T=Object(c.useRef)(!1),H=R((function(e){t.setActiveNotes(e);var n=t.activeNotesAsABC(e);r(e),d(n)})),P=R((function(e,n){T.current=!1;var c=K(e,y);m(n),S(e),x(c),t.reset(c.system)})),U=R((function(){T.current=!1;var e=K(E,y);x(e),t.reset(e.system)})),W=R((function(){})),q=R((function(){T.current=!0}));Object(c.useEffect)((function(){e.stateChangeEvent.on(H),t.matchEvent.on(q),t.missEvent.on(W)}),[e.stateChangeEvent,t.matchEvent,t.missEvent,H,q,W]),Object(c.useEffect)((function(){T.current&&0===a.length&&U()}));var z=Object(c.useCallback)((function(t){e.handleKeyboard(t,!1)}),[e]),Q=Object(c.useCallback)((function(t){e.handleKeyboard(t,!0)}),[e]),X=T.current?"#30C72C":"#3AC8DA";return Object(o.jsxs)("div",{id:"game",children:[Object(o.jsx)(f,{notes:e}),Object(o.jsxs)("div",{children:["\xa0",Object(o.jsx)("input",{type:"checkbox",onChange:function(e){G(e.target.checked)}}),"\xa0",Object(o.jsx)("label",{children:"Show stave ABC"}),"\xa0",Object(o.jsx)("input",{type:"checkbox",onChange:function(e){J(e.target.checked)}}),"\xa0",Object(o.jsx)("label",{children:"Show Grand Stave"}),"\xa0",Object(o.jsx)("button",{style:{width:"100px"},onClick:U,children:"Skip exercise"})]}),Object(o.jsx)(k,{onExercisesUpdate:P}),y&&Object(o.jsx)(F,{activeABC:b,activeAbcFill:X,grandStave:O&&O.grandStave||L,system:y.system,debugABC:B}),Object(o.jsx)(l,{width:1600,activeNotes:a,playNote:z,stopNote:Q})]})}a.a.render(Object(o.jsx)(J,{}),document.getElementById("root"))}},[[85,1,2]]]);
//# sourceMappingURL=main.cc744462.chunk.js.map